import{t as a,v as i,x as n,y as e}from"./chunks/vue-vendor.DsqmfNH5.js";import"./app.D4iUp3wF.js";import"./chunks/vendor.CimhImBR.js";const b=JSON.parse('{"title":"ssl","description":"","frontmatter":{},"headers":[],"relativePath":"nginx/ssl.md","filePath":"tools/nginx/ssl.md"}'),l={name:"nginx/ssl.md"};function t(p,s,r,h,c,d){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="ssl" tabindex="-1">ssl <a class="header-anchor" href="#ssl" aria-label="Permalink to &quot;ssl&quot;">​</a></h1><h2 id="证书和私钥文件" tabindex="-1">证书和私钥文件 <a class="header-anchor" href="#证书和私钥文件" aria-label="Permalink to &quot;证书和私钥文件&quot;">​</a></h2><h4 id="key-私钥文件" tabindex="-1">.key - 私钥文件 <a class="header-anchor" href="#key-私钥文件" aria-label="Permalink to &quot;.key - 私钥文件&quot;">​</a></h4><ul><li><p><strong>全称</strong>：Private Key</p></li><li><p><strong>核心作用</strong>：这是加密通信的核心密钥，属于<strong>绝对保密</strong>的文件，只有服务器自己持有。</p></li><li><p><strong>通俗理解</strong>：相当于你家的房门钥匙，只有你能拥有，绝对不能泄露给任何人。</p></li><li><p><strong>特点</strong>：</p><ul><li>用于解密客户端发来的加密数据，或对服务器发送的数据进行签名。</li><li>常见格式有 RSA 或 ECC 类型，文件内容是纯文本（PEM 格式）或二进制（DER 格式）。</li><li>示例内容（PEM 格式）：<div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>-----BEGIN PRIVATE KEY-----</span></span>
<span class="line"><span>MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDJ7+...（省略）</span></span>
<span class="line"><span>-----END PRIVATE KEY-----</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ul><h4 id="csr-证书签名请求文件" tabindex="-1">.csr - 证书签名请求文件 <a class="header-anchor" href="#csr-证书签名请求文件" aria-label="Permalink to &quot;.csr - 证书签名请求文件&quot;">​</a></h4><ul><li><strong>全称</strong>：Certificate Signing Request</li><li><strong>核心作用</strong>：这是你向证书颁发机构（CA，如 Let&#39;s Encrypt、阿里云、VeriSign）申请证书时提交的“申请文件”。</li><li><strong>通俗理解</strong>：相当于你向公安局申请身份证时填写的“申请表”，里面包含你的基本信息（域名、公司信息等）和公钥，但不包含私钥。</li><li><strong>特点</strong>： <ul><li>生成时会基于你的 <code>.key</code> 私钥生成，包含公钥和申请者的身份信息（如域名、组织名称）。</li><li>CA 会验证 <code>.csr</code> 中的信息，验证通过后颁发 <code>.crt</code> 证书。</li><li>示例内容（PEM 格式）：<div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>-----BEGIN CERTIFICATE REQUEST-----</span></span>
<span class="line"><span>MIICrjCCAZYCAQAwaDELMAkGA1UEBhMCQ04xETAPBgNVBAgMCEJhbmd...（省略）</span></span>
<span class="line"><span>-----END CERTIFICATE REQUEST-----</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ul><h4 id="crt-证书文件" tabindex="-1">.crt - 证书文件 <a class="header-anchor" href="#crt-证书文件" aria-label="Permalink to &quot;.crt - 证书文件&quot;">​</a></h4><ul><li><strong>全称</strong>：Certificate</li><li><strong>核心作用</strong>：CA 颁发的<strong>正式证书文件</strong>，包含公钥、域名、证书有效期、CA 签名等信息。</li><li><strong>通俗理解</strong>：相当于公安局给你颁发的“身份证”，证明你的服务器身份是合法的。</li><li><strong>特点</strong>： <ul><li>客户端（浏览器、APP）会验证这个证书的合法性，确认服务器是“可信的”。</li><li>格式可以是 PEM（文本）或 DER（二进制），Windows 系统常把 <code>.crt</code> 识别为二进制格式。</li><li>示例内容（PEM 格式）：<div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>-----BEGIN CERTIFICATE-----</span></span>
<span class="line"><span>MIIGAzCCBVugAwIBAgIRAIIQz7DSQONZRGo3w2mjiuAwDQYJKoZIhvcNAQELBQAw</span></span>
<span class="line"><span>-----END CERTIFICATE-----</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ul><h4 id="pem-通用容器格式" tabindex="-1">.pem - 通用容器格式 <a class="header-anchor" href="#pem-通用容器格式" aria-label="Permalink to &quot;.pem - 通用容器格式&quot;">​</a></h4><ul><li><strong>全称</strong>：Privacy Enhanced Mail（历史名称，现在已脱离邮件用途）</li><li><strong>核心作用</strong>：这不是一种“特定类型”的文件，而是<strong>文本格式的容器</strong>，可以装私钥、公钥、证书、CSR 等内容。</li><li><strong>通俗理解</strong>：相当于一个“文件袋”，可以装钥匙（.key）、身份证（.crt）、申请表（.csr），甚至可以把多个内容装在同一个 <code>.pem</code> 文件里（比如同时装私钥+证书）。</li><li><strong>特点</strong>： <ul><li>最常见的证书格式，所有主流服务器（Nginx、Apache、OpenSSL）都支持。</li><li>内容以 <code>-----BEGIN XXX-----</code> 开头，<code>-----END XXX-----</code> 结尾，中间是 Base64 编码的内容。</li><li>很多时候 <code>.crt</code>、<code>.key</code> 文件本质上也是 PEM 格式，只是后缀名不同（比如把 <code>.crt</code> 改名为 <code>.pem</code> 完全可以用）。</li></ul></li></ul><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><ol><li><code>.key</code> 是私钥文件，核心保密，用于解密/签名；</li><li><code>.csr</code> 是证书申请文件，用于向 CA 申请证书，包含公钥和身份信息；</li><li><code>.crt</code> 是 CA 颁发的正式证书，证明服务器身份；</li><li><code>.pem</code> 是通用文本容器格式，可封装私钥、证书、CSR 等，是最常用的证书格式。</li></ol><p>简单记：<code>.key</code> 是钥匙，<code>.csr</code> 是申请表，<code>.crt</code> 是身份证，<code>.pem</code> 是装这些东西的文件袋。</p><h2 id="nginx-配置" tabindex="-1">nginx 配置 <a class="header-anchor" href="#nginx-配置" aria-label="Permalink to &quot;nginx 配置&quot;">​</a></h2><h3 id="serve" tabindex="-1">serve <a class="header-anchor" href="#serve" aria-label="Permalink to &quot;serve&quot;">​</a></h3><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssl;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bb.cc;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     cert.pem;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cert.key;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_session_cache </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   shared:SSL:1m;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_session_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5m</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_ciphers </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HIGH:!aNULL:!MD5;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_prefer_server_ciphers </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="一、两个文件的核心对应关系" tabindex="-1">一、两个文件的核心对应关系 <a class="header-anchor" href="#一、两个文件的核心对应关系" aria-label="Permalink to &quot;一、两个文件的核心对应关系&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:center;">配置项</th><th style="text-align:center;">对应文件</th><th style="text-align:center;">文件类型</th><th style="text-align:center;">核心要求</th></tr></thead><tbody><tr><td style="text-align:center;"><code>ssl_certificate</code></td><td style="text-align:center;"><code>cert.pem</code></td><td style="text-align:center;">证书文件（PEM 格式）</td><td style="text-align:center;">必须是<strong>文本格式</strong>的证书，可包含服务器证书 + 中间证书（CA Bundle），以 <code>-----BEGIN CERTIFICATE-----</code> 开头</td></tr><tr><td style="text-align:center;"><code>ssl_certificate_key</code></td><td style="text-align:center;"><code>cert.key</code></td><td style="text-align:center;">私钥文件（PEM 格式）</td><td style="text-align:center;">必须是和 <code>cert.pem</code> 配对的私钥，文本格式，以 <code>-----BEGIN PRIVATE KEY-----</code> 或 <code>-----BEGIN RSA PRIVATE KEY-----</code> 开头</td></tr></tbody></table><h3 id="二、文件的正确格式与验证" tabindex="-1">二、文件的正确格式与验证 <a class="header-anchor" href="#二、文件的正确格式与验证" aria-label="Permalink to &quot;二、文件的正确格式与验证&quot;">​</a></h3><h4 id="_1-检查-cert-pem-是否有效" tabindex="-1">1. 检查 <code>cert.pem</code> 是否有效 <a class="header-anchor" href="#_1-检查-cert-pem-是否有效" aria-label="Permalink to &quot;1. 检查 \`cert.pem\` 是否有效&quot;">​</a></h4><p>验证证书格式和内容：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看证书基本信息（有效期、域名等）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -noout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -text</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 快速检查证书有效期</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -noout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dates</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>正常输出会显示证书的 <code>Subject</code>（包含域名）、<code>Not Before</code>（生效时间）、<code>Not After</code>（过期时间）等信息；</li><li>如果报错 <code>unable to load certificate</code>，说明文件格式错误（比如是 DER 二进制格式，需转换为 PEM）。</li></ul><h4 id="_2-检查-cert-key-是否有效且与证书匹配" tabindex="-1">2. 检查 <code>cert.key</code> 是否有效且与证书匹配 <a class="header-anchor" href="#_2-检查-cert-key-是否有效且与证书匹配" aria-label="Permalink to &quot;2. 检查 \`cert.key\` 是否有效且与证书匹配&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查私钥格式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证私钥和证书是否配对（核心！）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 提取证书的公钥指纹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -noout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -modulus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> md5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 提取私钥的公钥指纹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -noout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -modulus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> md5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>两步输出的 <strong>MD5 值必须完全一致</strong>，否则说明私钥和证书不匹配，Nginx 启动会失败；</p><ul><li><p>如果私钥有密码保护，会提示输入密码，建议移除密码（Nginx 不支持带密码的私钥，启动时会卡住）：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 移除私钥密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert_nopass.key</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 替换原文件（记得备份）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert_nopass.key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/www/SSL/cert.key</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul>`,27)]))}const u=a(l,[["render",t]]);export{b as __pageData,u as default};
