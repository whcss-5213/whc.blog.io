import{t as i,v as a,x as e,y as n}from"./chunks/vue-vendor.uhxHo2Le.js";import"./app.BmgZ_Et4.js";import"./chunks/vendor.CimhImBR.js";const l="/blog/assets/ssh%E6%8F%A1%E6%89%8B.zIXsQUvX.png",u=JSON.parse('{"title":"SSH","description":"","frontmatter":{},"headers":[],"relativePath":"linux/ssh.md","filePath":"linux/ssh.md"}'),p={name:"linux/ssh.md"};function t(h,s,d,r,o,c){return e(),a("div",null,s[0]||(s[0]=[n('<h1 id="ssh" tabindex="-1">SSH <a class="header-anchor" href="#ssh" aria-label="Permalink to &quot;SSH&quot;">​</a></h1><h2 id="ssh协议握手核心过程" tabindex="-1">SSH协议握手核心过程 <a class="header-anchor" href="#ssh协议握手核心过程" aria-label="Permalink to &quot;SSH协议握手核心过程&quot;">​</a></h2><ol><li>首先进行 TCP 三次握手.</li><li>之后进行 ssh 握手,确认 SSH 协议版本, SSH1、SSH2 版本不同,加密方式也不同.</li><li>密钥信息初始化,确定生成密钥的算法,生成临时公私钥.</li><li>服务端和客服端交换临时公钥,双方用自己的临时公私密钥和对方的临时公钥生成共享安全密钥.</li><li>服务端生成<code>host公私钥</code>和<code>交换哈希值</code>,用<code>host私钥</code>对<code>交换哈希值</code>进行加密,生成 <strong>交换哈希值(签名)</strong>. <ul><li><code>交换哈希值</code>: 共享安全密钥+双方临时密钥+服务端host公钥+客服端和服务端交换初始化负载信息+客服端和服务端版本号.</li></ul></li><li>服务端把<code>host公钥</code>和加密生成的<strong>交换哈希值(签名)</strong> 发给客服端.</li><li>客户端使用<code>host公钥</code>对<strong>交换哈希值(签名)</strong> 解密,得到<code>交换哈希值</code>,校验服务端的<code>交换哈希值</code>是否相同.</li><li>校验成功后,双方各生成新的6个密钥,两个数据加密密钥,两个数据完整性密钥,两个加强密钥.</li></ol><p><img src="'+l+`" alt="img" loading="lazy"></p><div class="tip custom-block"><p class="custom-block-title">参考</p><p><a href="https://www.bilibili.com/video/BV13P4y1o76u/" target="_blank" rel="noreferrer">SSH协议握手核心过程</a></p></div><h2 id="ssh-keygen" tabindex="-1">ssh-keygen <a class="header-anchor" href="#ssh-keygen" aria-label="Permalink to &quot;ssh-keygen&quot;">​</a></h2><p>ssh-keygen</p><ul><li>-f 指定了私钥文件的名称和位置</li><li>-t 指定了密钥的类型。</li><li>-C 为生成的密钥添加一个注释（comment）</li></ul><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果不带任何参数运行\`ssh-keygen\`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 它将提示用户输入保存密钥的文件位置（默认是\`~/.ssh/id_rsa\`，表示使用RSA算法生成的私钥）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 以及是否需要一个密码短语（passphrase）来保护私钥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generating public/private rsa key pair.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enter file in which to save the key (/root/.ssh/id_rsa): </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enter passphrase (empty for no passphrase): </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enter same passphrase again: </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fileName</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;dequan@example.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2889597857@qq.com&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="ssh-copy-id" tabindex="-1">ssh-copy-id <a class="header-anchor" href="#ssh-copy-id" aria-label="Permalink to &quot;ssh-copy-id&quot;">​</a></h2><p>将公钥拷贝到指定服务器的 <strong>~/.ssh/authorized_keys</strong> 文件中</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-copy-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [-i [identity_file]] [user@]hostname</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>-i [identity_file]：指定要使用的公钥文件。如果不指定，默认使用 ~/.ssh/id_rsa.pub 或 ~/.ssh/id_dsa.pub 等。</li><li>[user@]hostname：指定远程服务器的用户名和地址。如果不指定用户名，则默认使用当前用户名。</li></ul><p><code>ssh-keygen</code> 是一个用于生成、管理和转换认证密钥的工具，主要用于SSH（Secure Shell）协议的安全认证。SSH是一种网络协议，用于加密两台计算机之间的通信，保证数据的安全传输。<code>ssh-keygen</code>生成的密钥对包括一个公钥和一个私钥，公钥可以安全地分享给任何你希望与之进行SSH连接的服务器或设备，而私钥则必须保密，用于解密从服务器接收到的加密信息。</p><p>以下是<code>ssh-keygen</code>的一些常用选项和功能：</p><ol><li><p><strong>生成新的密钥对</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>指定密钥类型和长度</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4096</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个命令指定生成一个使用RSA算法的密钥对，长度为4096位。<code>-t</code>选项用于指定密钥类型（如<code>rsa</code>, <code>dsa</code>, <code>ecdsa</code>, <code>ed25519</code>等），<code>-b</code>选项用于指定密钥的位数。</p></li><li><p><strong>生成一个新的密钥对，并指定保存位置</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/my_custom_key</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个命令将在<code>~/.ssh/</code>目录下生成名为<code>my_custom_key</code>的私钥和<code>my_custom_key.pub</code>的公钥。</p></li><li><p><strong>修改现有密钥的密码短语</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/id_rsa</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个命令会提示用户输入当前密钥的密码短语（如果有的话），然后输入新的密码短语。</p></li><li><p><strong>显示公钥内容</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/id_rsa</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个命令将显示指定私钥对应的公钥内容。<code>-y</code>选项用于表示“显示公钥”。</p></li><li><p><strong>列出已知的主机密钥</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/known_hosts</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个命令会列出<code>~/.ssh/known_hosts</code>文件中存储的所有已知主机密钥的指纹。<code>-l</code>选项用于显示指纹。</p></li><li><p><strong>删除<code>known_hosts</code>文件中的条目</strong>： 虽然<code>ssh-keygen</code>本身不直接提供删除<code>known_hosts</code>文件中特定条目的命令，但你可以通过编辑该文件来手动删除。不过，使用<code>-R</code>选项可以移除特定主机的密钥：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hostname</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个命令会从<code>known_hosts</code>文件中移除与<code>hostname</code>相关联的所有密钥。</p></li></ol><p><code>ssh-keygen</code>是SSH安全认证机制的核心工具之一，掌握它的基本用法对于维护SSH连接的安全性至关重要。</p>`,17)]))}const y=i(p,[["render",t]]);export{u as __pageData,y as default};
